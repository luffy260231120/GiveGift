# GiveGift
 项目：实现一个活动收礼排行榜
 
 
功能描述：

1.提供一个送礼接口，用户B给主播A送礼时调用；

2.提供一个排行榜查询接口，根据主播收礼价值数从大到小排序；主播之间的排序

3.提供一个收礼流水查询接口，查询主播的收礼流水记录，按时间从近到远排序；

要求：

1.使用golang原生HTTP框架；

2.送礼接口要求使用HTTPPOST方法，请求数据使用Json格式；

3.排行榜查询接口和收礼流水查询接口要求使用HTTPGET方法，响应数据使用Json格式；

4.要求使用redis做缓存，使用mongo做数据存储；原子操作

5.排行榜接口并发要求超过1000qps；压测工具ab阿帕奇。

6.排行榜要求实时统计；redis-sortset排行榜

7.要求最多只能10个协程访问mongo数据库；


# DB的设计

礼物价值对应表：（不变）

礼物id:

礼物价值：
>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
收到的礼物时间表流水表

主播id:

用户id:

收到礼物的时间：

礼物数量：

礼物id:

# redis

主播id:

礼物总价值：


# 出现的问题
1.包之间的互相依赖，导致importcyclenotallowed

https://www.jb51.net/article/145533.htm

对于软相互依赖，利用分包的方法就能解决，有些函数导致的相互依赖只能通过分包解决；分包能细化包的功能；

对于硬相互依赖只能通过定义接口的方法解决；定义接口能提高包的独立性，同时也提高了追踪代码调用关系的难度；

2.测试排行榜并发时，当请求量大于15000左右后，出现 【端口数不足】问题

解决办法：添加连接池。
